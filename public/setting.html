<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>主题设置</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no"/>
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <link rel="stylesheet" href="/static/admin/static/component/pear/css/pear.css" />
    <link href="/static/admin/static/css/main.css?v=#(version)" rel="stylesheet"/>
    <link href="/static/public/libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <style>
        .layui-input-block{
            margin-left: 130px;
        }
        #swiperText{
            height: 200px;
        }
        #swiperBox{
            display: none;
        }
    </style>
</head>
<body class="pear-container">
<div class="p-container">
    <div class="layui-card">
        <div class="layui-card-body">
            <div class="layui-tab layui-tab-brief" lay-filter="settingTab">
                <ul class="layui-tab-title">
                    <li class="layui-this" lay-id="1">首页代码相关</li>
                    <li lay-id="2">请柬页相关</li>
                    <li lay-id="3">评论弹幕</li>
                    <li lay-id="4">背景音乐</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <form class="layui-form" action="">
                            <div class="layui-form-item">
                                <label class="layui-form-label">自定义代码</label>
                                <div class="layui-input-block">
                                    <textarea name="W_CUSTOM_CODE" placeholder="请输入自定义代码" class="layui-textarea" style="height: 200px">#option('W_CUSTOM_CODE')</textarea>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">代码速度</label>
                                <div class="layui-input-inline" style="margin-left: 45px;width: 200px">
                                    <select name="W_CODE_SPEED">
                                        <option value="1" #(optionCompare('W_CODE_SPEED', '1') ? 'selected': '')>快</option>
                                        <option value="2" #(optionCompare('W_CODE_SPEED', '2') ? 'selected': '')>正常</option>
                                        <option value="3" #(optionCompare('W_CODE_SPEED', '3') ? 'selected': '')>慢</option>
                                    </select>
                                </div>
                                <div class="layui-form-mid layui-word-aux">代码打字速度</div>
                            </div>

                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="pear-btn pear-btn-md pear-btn-primary" lay-submit lay-filter="optionForm">保存设置</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="layui-tab-item">
                        <form class="layui-form" action="">
                            <div class="layui-form-item">
                                <label class="layui-form-label">展示方式</label>
                                <div class="layui-input-inline" style="margin-left: 45px;width: 200px">
                                    <select name="W_TOP_TYPE" lay-filter="wTopType">
                                        <option value="1" #(optionCompare('W_TOP_TYPE', '1') ? 'selected': '')>轮播图</option>
                                        <option value="2" #(optionCompare('W_TOP_TYPE', '2') ? 'selected': '')>视频</option>
                                    </select>
                                </div>
                                <div class="layui-form-mid layui-word-aux">顶部展示方式,可选轮播图或视频</div>
                            </div>

                            <div class="layui-form-item" id="swiperBox" #(optionCompare('W_TOP_TYPE', '1') ? 'style="display: block"': '')>
                                <label class="layui-form-label">轮播图片:</label>
                                <div class="layui-input-block">
                                    <div class="layui-input-inline" style="width: calc(100% - 70px);">
                                        <textarea id="swiperText" class="layui-input">#option('W_SWIPER_IMG')</textarea>
                                        <input type="hidden" value="" id="swiperInput" placeholder="轮播图片" name="W_SWIPER_IMG" class="layui-input">
                                    </div>
                                    <div class="layui-inline" style="left: -11px;">
                                        <div id="W_SWIPER_IMG" class="p-upload-input-box">
                                            <i class="fa fa-photo" aria-hidden="true"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="layui-form-item" id="videoBox" #(optionCompare('W_TOP_TYPE', '2') ? 'style="display: block"': '')>
                                <label class="layui-form-label">视频地址</label>
                                <div class="layui-input-block">
                                    <input type="email" value="#option('W_VIDEO_URL')" name="W_VIDEO_URL" placeholder="视频地址" autocomplete="off" class="layui-input">
                                    <div class="layui-form-mid layui-word-aux">如选择视频展示,您可在附件列表将视频上传并将地址复制进来,或填写其他网站的视频地址</div>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">描述信息</label>
                                <div class="layui-input-block">
                                    <textarea name="W_DESC" placeholder="描述信息" class="layui-textarea" style="height: 150px">#option('W_DESC')</textarea>
                                    <div>
                                        示例:
                                        <pre class="layui-code" id="layuiCode"> </pre>
                                    </div>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="pear-btn pear-btn-md pear-btn-primary" lay-submit lay-filter="optionForm">保存设置</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="layui-tab-item">
                        <form class="layui-form" action="">
                            <div class="layui-form-item">
                                <label class="layui-form-label">文章ID</label>
                                <div class="layui-input-block">
                                    <input type="text" value="#option('W_ARTICLE_ID')" name="W_ARTICLE_ID" placeholder="文章ID" autocomplete="off" class="layui-input">
                                    <div class="layui-form-mid layui-word-aux">评论需绑定文章ID,您可创建一篇文章,将该文章的ID填入,如不想显示该文章,可将该文章设置为草稿</div>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">默认邮箱</label>
                                <div class="layui-input-block">
                                    <input type="email" value="#option('W_COMMENT_EMAIL')" name="W_COMMENT_EMAIL" placeholder="默认邮箱" autocomplete="off" class="layui-input">
                                    <div class="layui-form-mid layui-word-aux">评论需填写邮箱,但是作为婚礼请柬,填入邮箱太过麻烦,所以需要在此统一设置,评论时只需填写昵称就行了</div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="pear-btn pear-btn-md pear-btn-primary" lay-submit lay-filter="optionForm">保存设置</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="layui-tab-item">
                        <form class="layui-form" action="">
                            <div class="layui-form-item">
                                <label class="layui-form-label">播放方式</label>
                                <div class="layui-input-inline" style="margin-left: 45px;width: 300px">
                                    <select name="W_MUSIC_PLAY_TYPE">
                                        <option value="0" #(optionCompare('W_MUSIC_PLAY_TYPE', '0') ? 'selected': '')>不使用背景音乐</option>
                                        <option value="1" #(optionCompare('W_MUSIC_PLAY_TYPE', '1') ? 'selected': '')>打开页面自动播放(部分浏览器不支持)</option>
                                        <option value="2" #(optionCompare('W_MUSIC_PLAY_TYPE', '2') ? 'selected': '')>开启请柬时播放</option>
                                    </select>
                                </div>
                                <div class="layui-form-mid layui-word-aux">背景音乐的播放方式,如果请柬页内容是视频的话,建议不要使用背景音乐</div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">音乐地址</label>
                                <div class="layui-input-block">
                                    <input type="email" value="#option('W_MUSIC_URL')" name="W_MUSIC_URL" placeholder="音乐地址" autocomplete="off" class="layui-input">
                                    <div class="layui-form-mid layui-word-aux">您可在附件列表将音乐文件上传并将地址复制进来,或填写其他网站的音乐地址</div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="pear-btn pear-btn-md pear-btn-primary" lay-submit lay-filter="optionForm">保存设置</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/static/public/libs/jquery/jquery-3.5.1.min.js"></script>
<script src="/static/public/libs/layui-v2.5.6/layui/layui.js"></script>
<script src="/static/admin/static/component/pear/pear.js"></script>
<script src="/static/public/js/main.js?v=#(version)"></script>
<script>
    let tipText = `
            <p>我们结婚啦！</p>
            <p><b>Jun & undefined</b></p>
            <p>时间：invalid date value</p>
            <p>地点：<b>location can not be found</b></p>
    `;
    $("#layuiCode").text(tipText);
    let layer,form,toast,code;
    layui.use(['layer','form','toast','code'], function() {
        layer = layui.layer;
        form = layui.form;
        toast = layui.toast;
        code = layui.code;
        form.on('select(wTopType)', function (data) {
            if (data.value === '1') {
                $("#swiperBox").show();
                $("#videoBox").hide();
            }
            if (data.value === '2') {
                $("#swiperBox").hide();
                $("#videoBox").show();
            }
        });
        form.on('submit(optionForm)', function(data){
            data.field.W_SWIPER_IMG = $("#swiperText").val();
            $.ajax({
                type: "POST",
                url: "/admin/setting/save",
                contentType:"application/json",
                data: JSON.stringify(data.field),
                success:function(d){
                    if (d.code === 200){
                        parent.toast.success({message: "保存成功",position: 'topCenter'});
                    } else {
                        parent.toast.error({message: d.msg,position: 'topCenter'});
                    }
                },
                error: function (data) {
                    parent.toast.error({message: "保存失败",position: 'topCenter'});
                }
            });
            return false;
        });
    });

    Object.defineProperty(document.getElementById("swiperInput"),"value", {
        set: (v) => {
            $("#swiperText").val( $("#swiperText").val() + v + ',\n');
        }
    });
</script>
</body>
</html>